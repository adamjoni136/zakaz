<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Интернет-магазин</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:10px; background:#f5f5f5; overflow-x:hidden; }
    h1,h2 { text-align:center; animation:fadeIn 0.8s ease forwards; }
    #search,#sort,#toggleHistory { display:block; width:100%; max-width:400px; margin:20px auto; padding:10px; font-size:16px; box-sizing:border-box; border:1px solid #ccc; border-radius:4px; }
    #search:focus,#sort:focus,#toggleHistory:focus { outline:none; box-shadow:0 0 5px rgba(40,167,69,0.5); }
    table { width:100%; border-collapse:collapse; background:#fff; box-shadow:0 0 10px #ccc; margin-bottom:20px; }
    th,td { border:1px solid #ccc; padding:10px; font-size:14px; text-align:center; }
    th { background:#eee; }
    img.product-img { max-width:80px; height:auto; transition:transform 0.3s ease; }
    img.product-img:hover { transform:scale(1.1); }
    input[type="number"] { width:60px; }
    .order-form { background:#fff; padding:20px; box-shadow:0 0 10px #ccc; animation:fadeIn 0.8s ease 0.2s forwards; opacity:0; }
    .order-form input, .order-form button, textarea { padding:12px; margin:8px 0; width:100%; box-sizing:border-box; font-size:16px; }
    .order-form button { background:#28a745; color:#fff; border:none; cursor:pointer; transition:all 0.3s ease; position:relative; }
    .order-form button:active { transform:scale(0.95); }
    .order-form button.loading { pointer-events:none; background:#218838; }
    .order-form button.loading::after { content:''; position:absolute; right:15px; top:50%; width:16px; height:16px; margin-top:-8px; border:2px solid #fff; border-top:2px solid transparent; border-radius:50%; animation:spin 0.7s linear infinite; }
    @keyframes spin { 0%{transform:rotate(0)}100%{transform:rotate(360deg)} }
    .cart-item { margin-bottom:8px; font-size:14px; }
    .cart-item-animate { animation:slideIn 0.4s ease forwards; }
    @keyframes slideIn { from{opacity:0;transform:translateX(100%)} to{opacity:1;transform:translateX(0)} }
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
    #orderHistory { background:#fff; padding:20px; box-shadow:0 0 10px #ccc; margin-top:20px; display:none; }
    #historyList { list-style:none; padding:0; max-width:600px; margin:0 auto; }
    #historyList li { padding:10px; border-bottom:1px solid #ddd; }
    #historyList time { display:block; font-size:12px; color:#666; margin-bottom:6px; }
  </style>
</head>
<body>

  <h1>Каталог товаров</h1>
  <input type="text" id="search" placeholder="Поиск товара..." />
  <select id="sort">
    <option value="">Сортировать по цене</option>
    <option value="asc">По возрастанию</option>
    <option value="desc">По убыванию</option>
  </select>

  <form id="orderForm">
    <table>
      <thead>
        <tr><th>Фото</th><th>Название</th><th>Цена</th><th>Кол-во</th><th>Заказать</th></tr>
      </thead>
      <tbody>
        <tr><td><img class="product-img" src="шотка120.jpg" alt="шотка(3361)"/></td><td>шотка(3361)</td><td>40</td><td><input type="number" min="1" value="1"/></td><td><button type="button" onclick="addToCart('шотка(3361)',40,'шотка120.jpg',this)">добавить</button></td></tr>
        <tr><td><img class="product-img" src="шотка106.jpg" alt="шотка(106)"/></td><td>шотка(106)</td><td>40</td><td><input type="number" min="1" value="1"/></td><td><button type="button" onclick="addToCart('шотка(106)',40,'шотка106.jpg',this)">добавить</button></td></tr>
        <tr><td><img class="product-img" src="шотка авалный.jpg" alt="шотка(3369)"/></td><td>шотка(3369)</td><td>50</td><td><input type="number" min="1" value="1"/></td><td><button type="button" onclick="addToCart('шотка(3369)',50,'шотка авалный.jpg',this)">добавить</button></td></tr>
<tr><td><img class="product-img" src="шотка80.jpg" alt="шотка(80)"/></td><td>шотка(80)</td><td>55</td><td><input type="number" min="1" value="1"/></td><td><button type="button" onclick="addToCart('шотка(80)',55,'шотка80.jpg',this)">добавить</button></td></tr>
      </tbody>
    </table>

    <div class="order-form">
      <h2>Оформить заказ</h2>
      <input type="text" id="name" placeholder="Ваше имя" required/>
      <input type="tel" id="phone" placeholder="Телефон" required/>
      <input type="text" id="address" placeholder="Адрес доставки" required/>
      <div id="cartList"></div>
      <textarea id="cartText" readonly placeholder="Корзина..."></textarea>
      <button type="submit">Отправить заказ</button>
    </div>
  </form>

  <button id="toggleHistory">Показать историю заказов</button>
  <div id="orderHistory">
    <h2>История заказов</h2>
    <ul id="historyList"></ul>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const searchInput = document.getElementById('search');
      const sortSelect  = document.getElementById('sort');
      const tbody       = document.querySelector('table tbody');
      const toggleBtn   = document.getElementById('toggleHistory');
      const historyDiv  = document.getElementById('orderHistory');
      const historyList = document.getElementById('historyList');

      function filterAndSort() {
        const filter = searchInput.value.toLowerCase();
        let rows = Array.from(tbody.rows);

        // Поиск
        rows.forEach(r => {
          const title = r.cells[1].textContent.toLowerCase();
          r.style.display = title.includes(filter) ? '' : 'none';
        });

        // Сортировка
        const order = sortSelect.value;
        if (order) {
          rows = rows.filter(r => r.style.display !== 'none');
          rows.sort((a,b) => {
            const pa = +a.cells[2].textContent;
            const pb = +b.cells[2].textContent;
            return order==='asc'? pa-pb : pb-pa;
          });
          rows.forEach(r => tbody.appendChild(r));
        }
      }

      searchInput.addEventListener('input', filterAndSort);
      sortSelect.addEventListener('change', filterAndSort);

      // Появление строк
      document.querySelectorAll('table tbody tr').forEach((r,i) => {
        r.style.opacity=0; r.style.transform='translateY(20px)';
        r.style.animation = `fadeIn 0.5s ease ${i*0.1}s forwards`;
      });

      toggleBtn.addEventListener('click', () => {
        historyDiv.style.display = historyDiv.style.display==='none'?'block':'none';
        if (historyDiv.style.display==='block') populateHistory();
      });

      function populateHistory() {
        const history = JSON.parse(localStorage.getItem('orderHistory')||'[]');
        historyList.innerHTML = '';
        history.forEach(o => {
          const li = document.createElement('li');
          const time = document.createElement('time');
          time.textContent = new Date(o.timestamp).toLocaleString('ru-RU');
          li.appendChild(time);
          li.append(o.name+', '+o.phone+', '+o.address);
          const ul = document.createElement('ul');
          o.items.forEach(i => {
            const iti = document.createElement('li');
            iti.textContent = `${i.title} — ${i.qty} × ${i.price}с = ${i.total}с`;

            ul.appendChild(iti);
          });
          li.appendChild(ul);
          historyList.appendChild(li);
        });
      }
    });

    const cartItems = [];
    function addToCart(title,price,image,btn){
      const row = btn.closest('tr');
      const qty = +row.querySelector('input[type="number"]').value;
      const key = title+image;
      btn.classList.add('cart-button-animate');
      setTimeout(()=>btn.classList.remove('cart-button-animate'),300);
      const ex = cartItems.find(i=>i.uniqueKey===key);
      if(ex){ ex.qty+=qty; ex.total=ex.qty*price; }
      else{ cartItems.push({id:Date.now(),title,price,qty,image,uniqueKey:key,total:price*qty}); }
      updateCartDisplay();
    }
function updateCartDisplay(){
      const cl = document.getElementById('cartList'), ct=document.getElementById('cartText');
      cl.innerHTML=''; ct.value='';
      cartItems.forEach(i=>{
        const div=document.createElement('div');
        div.className='cart-item cart-item-animate';
        div.textContent = `${i.title} — ${i.qty} шт. x ${i.price}с = ${i.total}с`;
        const btn=document.createElement('button');
        btn.textContent='×'; btn.onclick=()=>removeFromCart(i.id);
        div.appendChild(btn); cl.appendChild(div);
        ct.value+=div.textContent+'\n';
      });
    }

    function removeFromCart(id){
      const idx=cartItems.findIndex(i=>i.id===id);
      if(idx!==-1){ cartItems.splice(idx,1); updateCartDisplay(); }
    }

    document.getElementById('orderForm').addEventListener('submit',function(e){
      e.preventDefault();
      const btn=this.querySelector('button[type="submit"]');
      const name=document.getElementById('name').value;
      const phone=document.getElementById('phone').value;
      const address=document.getElementById('address').value;
      const items = cartItems.map(i=>({title:i.title,qty:i.qty,price:i.price,total:i.total}));
      const msg = `Новый заказ:\nИмя: ${name}\nТелефон: ${phone}\nАдрес: ${address}\nТовары:\n${items.map(i=>`${i.title} — ${i.qty}×${i.price}с`).join('\n')}`;

      btn.classList.add('loading'); btn.textContent='Отправка...';

      fetch(`https://api.telegram.org/bot7960727448:AAF0B2mizrzj7sjHP68n-1IcjLoNc6kwVkE/sendMessage`, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body:JSON.stringify({chat_id:'5567924440',text:msg})
      }).then(res=>{
        btn.classList.remove('loading'); btn.textContent='Отправить заказ';
        if(res.ok){
          // сохранить в историю
          const history = JSON.parse(localStorage.getItem('orderHistory')||'[]');
          history.push({ timestamp: new Date(), name, phone, address, items });
          localStorage.setItem('orderHistory', JSON.stringify(history));
          alert('Заказ отправлен!');
          cartItems.length=0; updateCartDisplay(); this.reset();
        } else alert('Ошибка при отправке.');
      }).catch(()=>{
        btn.classList.remove('loading'); btn.textContent='Отправить заказ';
        alert('Ошибка сети.');
      });
    });
  </script>
</body>
</html>